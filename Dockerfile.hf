# Dockerfile –¥–ª—è Hugging Face Spaces
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ HF Spaces UI

FROM node:18-alpine

WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package —Ñ–∞–π–ª—ã
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
RUN npm install --production

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä
COPY server/ ./server/

# –ö–æ–ø–∏—Ä—É–µ–º frontend (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏)
COPY dist/ ./dist/ 2>/dev/null || true

EXPOSE 7860

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ HF Spaces UI
# Settings ‚Üí Variables and secrets
# PORT, NODE_ENV, MONGODB_URI, JWT_SECRET, FRONTEND_URL, BACKEND_URL, OPENWEATHER_API_KEY

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
RUN echo '#!/bin/sh\n\
echo "üîç Checking environment variables..."\n\
echo "PORT: $PORT"\n\
echo "NODE_ENV: $NODE_ENV"\n\
echo "MONGODB_URI: ${MONGODB_URI:-(not set)}"\n\
echo "BACKEND_URL: $BACKEND_URL"\n\
echo "FRONTEND_URL: $FRONTEND_URL"\n\
echo "OPENWEATHER_API_KEY: ${OPENWEATHER_API_KEY:-(not set)}"\n\
echo ""' > /check-env.sh && chmod +x /check-env.sh

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –∑–∞—Ç–µ–º —Å–µ—Ä–≤–µ—Ä
CMD ["/bin/sh", "-c", "/check-env.sh && node server/index.js"]
