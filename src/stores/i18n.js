import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

// Переводы
const translations = {
  en: {
    nav: {
      dashboard: 'Dashboard',
      devices: 'Devices',
      status: 'Status',
      profile: 'Profile',
      logout: 'Logout',
      logoutConfirm: 'Are you sure you want to logout?',
      home: 'Home',
      exit: 'Exit'
    },
    dashboard: {
      title: 'Dashboard',
      welcome: 'Welcome to Smart Home',
      hello: 'Hello',
      devicesConnected: 'Devices connected',
      addDevice: 'Add device',
      rooms: 'Rooms',
      allDevices: 'All devices',
      devices: 'devices',
      noDevicesInRoom: 'No devices in room "{room}" yet',
      noDevicesYet: 'Nothing here yet...',
      editDevice: 'Edit device',
      deviceName: 'Device name',
      deviceNamePlaceholder: 'For example: Living room lamp',
      deviceType: 'Device type',
      selectType: 'Select type',
      room: 'Room',
      roomPlaceholder: 'For example: Living room',
      roomHint: 'Start typing a name or select from the list',
      on: 'On',
      off: 'Off',
      cancel: 'Cancel',
      save: 'Save',
      add: 'Add',
      edit: 'Edit',
      delete: 'Delete',
      deleteConfirm: 'Are you sure you want to delete this device?',
      actionLogs: 'Action logs',
      today: 'Today',
      noActions: 'No actions yet',
      activeDevices: 'Active Devices',
      temperature: 'Temperature',
      humidity: 'Humidity',
      energyUsage: 'Energy Usage',
      kWh: 'kWh',
      favorites: 'Favorites',
      addToFavorites: 'Add to favorites',
      removeFromFavorites: 'Remove from favorites'
    },
    deviceTypes: {
      light: 'Lighting',
      thermostat: 'Thermostat',
      camera: 'Camera',
      lock: 'Lock',
      speaker: 'Speaker',
      tv: 'TV',
      socket: 'Socket',
      sensor: 'Sensor'
    },
    devices: {
      title: 'My Devices',
      addDevice: 'Add Device',
      noDevices: 'You have no devices yet',
      noDevicesSubtitle: 'Start adding smart devices',
      addFirstDevice: 'Add first device',
      status: 'Status',
      room: 'Room',
      on: 'On',
      off: 'Off',
      turnOn: 'Turn on',
      turnOff: 'Turn off',
      edit: 'Edit',
      delete: 'Delete',
      deleteConfirm: 'Delete this device?',
      editDevice: 'Edit device',
      addDeviceTitle: 'Add device',
      name: 'Name',
      type: 'Type',
      selectType: 'Select type',
      save: 'Save',
      add: 'Add',
      cancel: 'Cancel'
    },
    status: {
      title: 'Status and Conditions',
      subtitle: 'Monitoring your home parameters',
      allSystems: 'All Systems Operational',
      lastUpdate: 'Last update',
      weather: 'Weather',
      humidity: 'Humidity',
      wind: 'Wind',
      feelsLike: 'Feels like',
      forecast3days: '3-day forecast',
      ms: 'm/s',
      roomTemperatures: 'Room temperatures',
      cold: 'Cold',
      optimal: 'Comfortable',
      hot: 'Hot',
      averageTemp: 'Average home temperature',
      airQuality: 'Air quality',
      aqiGood: 'Excellent',
      aqiModerate: 'Good',
      aqiUnhealthySensitive: 'Moderate',
      aqiUnhealthy: 'Poor',
      aqiDescGood: 'Air quality is excellent',
      aqiDescModerate: 'Air quality is acceptable',
      aqiDescUnhealthySensitive: 'May affect health',
      aqiDescUnhealthy: 'Unhealthy air quality',
      energy: 'Energy consumption',
      today: 'Today',
      thanYesterday: 'than yesterday',
      topConsumers: 'Highest consuming devices',
      kWhUnit: 'kWh',
      wattUnit: 'W',
      security: 'Security',
      allSecure: 'All clear',
      needsAttention: 'Needs attention',
      frontDoor: 'Front door',
      motionSensors: 'Motion sensors',
      cameras: 'Cameras',
      securitySystem: 'Security system',
      closed: 'Closed',
      active: 'Active',
      working: 'Working',
      enabled: 'Enabled',
      system: 'System',
      devicesOnline: 'Devices online',
      uptime: 'Uptime',
      softwareVersion: 'Software version',
      checkUpdates: 'Check for updates',
      tomorrow: 'Tomorrow',
      weatherDescPartlyCloudy: 'Partly cloudy',
      conditioner: 'Air conditioner',
      fridge: 'Fridge',
      washingMachine: 'Washing machine',
      daysHours: '{days} days {hours} hours',
      daysAgo: '{n} days ago',
      enterCity: 'Enter city',
      weatherError: 'Failed to load weather data',
      noTemperatureDevices: 'No temperature devices',
      addThermostatHint: 'Add a thermostat or sensor to see room temperatures',
      noSecurityDevices: 'No security devices',
      addSecurityHint: 'Add a camera, lock, or sensor to monitor security',
      offline: 'Offline',
      opened: 'Open',
      inactive: 'Inactive'
    },
    profile: {
      title: 'Profile',
      email: 'Email',
      name: 'Name',
      save: 'Save Changes',
      cancel: 'Cancel',
      memberSince: 'Member since',
      recentTime: 'recently',
      totalDevices: 'Total devices',
      activeCount: 'Active',
      roomsCount: 'Rooms',
      activity: 'Activity',
      accountSettings: 'Account settings',
      personalData: 'Personal data',
      personalDataDesc: 'Change your name and email',
      change: 'Change',
      security: 'Security',
      securityDesc: 'Password and security management',
      password: 'Password',
      twoFactor: 'Two-factor authentication',
      setup: 'Setup',
      disabled: 'Disabled',
      notifications: 'Notifications',
      notificationsDesc: 'Configure how you receive notifications',
      emailNotifications: 'Email notifications',
      emailNotificationsDesc: 'Receive emails about important events',
      pushNotifications: 'Push notifications',
      pushNotificationsDesc: 'Browser notifications',
      privacy: 'Privacy',
      privacyDesc: 'Data and privacy management',
      downloadData: 'Download my data',
      deleteAccount: 'Delete account',
      deleteConfirm: 'Are you sure you want to delete your account? This action cannot be undone!',
      deleteWarning: 'Last warning! All your data will be permanently deleted.',
      deleteSoon: 'Account deletion will be available in the next version.',
      home: 'Home',
      statusPage: 'Status',
      exit: 'Exit',
      exitConfirm: 'Are you sure you want to logout?',
      editName: 'Edit name',
      editEmail: 'Edit email',
      newName: 'New name',
      newEmail: 'New email',
      saveSuccess: 'Changes saved successfully',
      changePassword: 'Change password',
      currentPassword: 'Current password',
      newPassword: 'New password',
      confirmNewPassword: 'Confirm new password',
      passwordChanged: 'Password changed successfully',
      passwordsDontMatch: 'Passwords do not match',
      uploadAvatar: 'Upload avatar',
      removeAvatar: 'Remove avatar',
      avatarUploaded: 'Avatar uploaded',
      avatarRemoved: 'Avatar removed',
      deleteAccountDesc: 'Enter your password to confirm account deletion',
      accountDeleted: 'Account deleted',
      enterPassword: 'Enter password'
    },
    auth: {
      login: 'Login',
      register: 'Register',
      email: 'Email',
      password: 'Password',
      confirmPassword: 'Confirm Password',
      name: 'Name',
      dontHaveAccount: "Don't have an account?",
      alreadyHaveAccount: 'Already have an account?',
      forgotPassword: 'Forgot password?',
      noAccountCanRegister: "If you don't have an account you can",
      registerLink: 'register',
      alreadyHaveAccountLink: 'Login',
      enterEmail: 'Enter your email',
      enterPassword: 'Enter your password',
      enterName: 'Enter your name',
      confirmYourPassword: 'Confirm your password',
      loggingIn: 'Logging in...',
      registering: 'Registering...',
      registerButton: 'Register',
      socialText: 'You can also use quick registration/login via these services',
      soon: 'Coming soon',
      passwordsMatch: 'Passwords match',
      passwordsDontMatch: 'Passwords do not match',
      passwordTooShort: 'Password must be at least 8 characters',
      passwordNeedsDigit: 'Password must contain at least one digit',
      passwordNeedsSpecial: 'Password must contain at least one special character (!@#$%^&* etc.)',
      hintMinLength: 'At least 8 characters',
      hintDigit: 'At least one digit (0-9)',
      hintSpecial: 'At least one special character (!@#$%^&*)',
      invalidEmail: 'Please enter a valid email address',
      verifyTitle: 'Confirm your email',
      verifySubtitle: 'We sent a 6-digit code to',
      verifyCodePlaceholder: 'Enter the 6-digit code',
      verifyButton: 'Confirm',
      verifying: 'Verifying...',
      resendCode: 'Resend code',
      codeSent: 'Code sent!',
      codeResent: 'A new code has been sent',
      checkServerConsole: 'Check the server console for the code',
      emailNotVerified: 'Your email is not verified yet',
      goToVerification: 'Verify',
      oauthError: 'Login via service failed. Try again',
      forgotPasswordTitle: 'Reset password',
      forgotPasswordSubtitle: 'Enter your email and we will send you a reset code',
      sendResetCode: 'Send code',
      sending: 'Sending...',
      backToLogin: 'Back to login',
      enterResetCode: 'Enter the code',
      resetCodeSentTo: 'We sent a 6-digit code to',
      confirmCode: 'Confirm',
      newPasswordTitle: 'New password',
      newPasswordSubtitle: 'Create a new password for your account',
      enterNewPassword: 'Enter new password',
      resetPassword: 'Reset password',
      resetting: 'Resetting...',
      passwordResetSuccess: 'Password reset!',
      passwordResetSuccessSubtitle: 'Your password has been successfully changed. You can now log in with the new password.'
    },
    common: {
      loading: 'Loading...',
      error: 'Error',
      success: 'Success',
      save: 'Save',
      cancel: 'Cancel',
      delete: 'Delete',
      edit: 'Edit',
      close: 'Close',
      search: 'Search',
      filter: 'Filter',
      settings: 'Settings'
    },
    logs: {
      device_on: 'Device turned on: {name}',
      device_off: 'Device turned off: {name}',
      device_add: 'Device added: {name}',
      device_update: 'Device updated: {name}',
      device_delete: 'Device deleted: {name}',
      user_login: 'Logged in',
      password_change: 'Password changed',
      profile_update: 'Profile updated',
      field_name: 'name',
      field_room: 'room',
      field_type: 'type',
      field_property: 'property',
      changed_from_to: 'changed from "{from}" to "{to}"',
      just_now: 'just now',
      minutes_ago: '{n} min ago',
      hours_ago: '{n} hours ago',
      days_ago: '{n} days ago'
    }
  },
  ru: {
    nav: {
      dashboard: 'Панель',
      devices: 'Устройства',
      status: 'Состояния',
      profile: 'Профиль',
      logout: 'Выйти',
      logoutConfirm: 'Вы уверены, что хотите выйти?',
      home: 'Главная',
      exit: 'Выход'
    },
    dashboard: {
      title: 'Панель управления',
      welcome: 'Добро пожаловать в Smart Home',
      hello: 'Привет',
      devicesConnected: 'Устройств подключено',
      addDevice: 'Добавить устройство',
      rooms: 'Комнаты',
      allDevices: 'Все устройства',
      devices: 'устройств',
      noDevicesInRoom: 'В комнате "{room}" пока нет устройств',
      noDevicesYet: 'Пока тут ничего нет....',
      editDevice: 'Редактировать устройство',
      deviceName: 'Название устройства',
      deviceNamePlaceholder: 'Например: Лампа в гостиной',
      deviceType: 'Тип устройства',
      selectType: 'Выберите тип',
      room: 'Комната',
      roomPlaceholder: 'Например: Гостиная',
      roomHint: 'Начните вводить название или выберите из списка',
      on: 'Включено',
      off: 'Выключено',
      cancel: 'Отмена',
      save: 'Сохранить',
      add: 'Добавить',
      edit: 'Редактировать',
      delete: 'Удалить',
      deleteConfirm: 'Вы уверены, что хотите удалить это устройство?',
      actionLogs: 'Логи действий',
      today: 'Сегодня',
      noActions: 'Пока нет действий',
      activeDevices: 'Активные устройства',
      temperature: 'Температура',
      humidity: 'Влажность',
      energyUsage: 'Потребление энергии',
      kWh: 'кВт⋅ч',
      favorites: 'Избранное',
      addToFavorites: 'Добавить в избранное',
      removeFromFavorites: 'Удалить из избранного'
    },
    deviceTypes: {
      light: 'Освещение',
      thermostat: 'Термостат',
      camera: 'Камера',
      lock: 'Замок',
      speaker: 'Динамик',
      tv: 'Телевизор',
      socket: 'Розетка',
      sensor: 'Датчик'
    },
    devices: {
      title: 'Мои устройства',
      addDevice: 'Добавить устройство',
      noDevices: 'У вас пока нет устройств',
      noDevicesSubtitle: 'Начните добавлять умные устройства',
      addFirstDevice: 'Добавить первое устройство',
      status: 'Статус',
      room: 'Комната',
      on: 'Включено',
      off: 'Выключено',
      turnOn: 'Включить',
      turnOff: 'Выключить',
      edit: 'Изменить',
      delete: 'Удалить',
      deleteConfirm: 'Удалить это устройство?',
      editDevice: 'Редактировать',
      addDeviceTitle: 'Добавить устройство',
      name: 'Название',
      type: 'Тип',
      selectType: 'Выберите тип',
      save: 'Сохранить',
      add: 'Добавить',
      cancel: 'Отмена'
    },
    status: {
      title: 'Состояния и условия',
      subtitle: 'Мониторинг параметров вашего дома',
      allSystems: 'Все системы работают нормально',
      lastUpdate: 'Последнее обновление',
      weather: 'Погода',
      humidity: 'Влажность',
      wind: 'Ветер',
      feelsLike: 'Ощущается',
      forecast3days: 'Прогноз на 3 дня',
      ms: 'м/с',
      roomTemperatures: 'Температура комнат',
      cold: 'Холодно',
      optimal: 'Комфортно',
      hot: 'Жарко',
      averageTemp: 'Средняя температура дома',
      airQuality: 'Качество воздуха',
      aqiGood: 'Отлично',
      aqiModerate: 'Хорошо',
      aqiUnhealthySensitive: 'Умеренно',
      aqiUnhealthy: 'Плохо',
      aqiDescGood: 'Качество воздуха отличное',
      aqiDescModerate: 'Качество воздуха приемлемое',
      aqiDescUnhealthySensitive: 'Может влиять на здоровье',
      aqiDescUnhealthy: 'Нездоровое качество воздуха',
      energy: 'Энергопотребление',
      today: 'Сегодня',
      thanYesterday: 'чем вчера',
      topConsumers: 'Устройства с наибольшим потреблением',
      kWhUnit: 'кВт·ч',
      wattUnit: 'Вт',
      security: 'Безопасность',
      allSecure: 'Всё в порядке',
      needsAttention: 'Требует внимания',
      frontDoor: 'Входная дверь',
      motionSensors: 'Датчики движения',
      cameras: 'Камеры',
      securitySystem: 'Охранная система',
      closed: 'Закрыта',
      active: 'Активны',
      working: 'Работают',
      enabled: 'Включена',
      system: 'Система',
      devicesOnline: 'Устройств онлайн',
      uptime: 'Время работы',
      softwareVersion: 'Версия ПО',
      checkUpdates: 'Проверить обновления',
      tomorrow: 'Завтра',
      weatherDescPartlyCloudy: 'Переменная облачность',
      conditioner: 'Кондиционер',
      fridge: 'Холодильник',
      washingMachine: 'Стиральная машина',
      daysHours: '{days} дней {hours} часов',
      daysAgo: '{n} дня назад',
      enterCity: 'Введите город',
      weatherError: 'Не удалось загрузить данные о погоде',
      noTemperatureDevices: 'Нет устройств с температурой',
      addThermostatHint: 'Добавьте термостат или датчик для отображения температуры комнат',
      noSecurityDevices: 'Нет устройств безопасности',
      addSecurityHint: 'Добавьте камеру, замок или датчик для мониторинга безопасности',
      offline: 'Не в сети',
      opened: 'Открыт',
      inactive: 'Неактивен'
    },
    profile: {
      title: 'Профиль',
      email: 'Email',
      name: 'Имя',
      save: 'Сохранить изменения',
      cancel: 'Отмена',
      memberSince: 'Пользователь с',
      recentTime: 'недавнего времени',
      totalDevices: 'Всего устройств',
      activeCount: 'Активных',
      roomsCount: 'Комнат',
      activity: 'Активность',
      accountSettings: 'Настройки аккаунта',
      personalData: 'Личные данные',
      personalDataDesc: 'Измените свое имя и email',
      change: 'Изменить',
      security: 'Безопасность',
      securityDesc: 'Управление паролем и безопасностью',
      password: 'Пароль',
      twoFactor: 'Двухфакторная аутентификация',
      setup: 'Настроить',
      disabled: 'Выключено',
      notifications: 'Уведомления',
      notificationsDesc: 'Настройте способы получения уведомлений',
      emailNotifications: 'Email уведомления',
      emailNotificationsDesc: 'Получать письма о важных событиях',
      pushNotifications: 'Push уведомления',
      pushNotificationsDesc: 'Уведомления в браузере',
      privacy: 'Приватность',
      privacyDesc: 'Управление данными и конфиденциальностью',
      downloadData: 'Скачать мои данные',
      deleteAccount: 'Удалить аккаунт',
      deleteConfirm: 'Вы уверены, что хотите удалить аккаунт? Это действие нельзя отменить!',
      deleteWarning: 'Последнее предупреждение! Все ваши данные будут удалены безвозвратно.',
      deleteSoon: 'Функция удаления аккаунта будет доступна в следующей версии.',
      home: 'Главная',
      statusPage: 'Состояния',
      exit: 'Выход',
      exitConfirm: 'Вы уверены, что хотите выйти?',
      editName: 'Изменить имя',
      editEmail: 'Изменить email',
      newName: 'Новое имя',
      newEmail: 'Новый email',
      saveSuccess: 'Изменения сохранены',
      changePassword: 'Сменить пароль',
      currentPassword: 'Текущий пароль',
      newPassword: 'Новый пароль',
      confirmNewPassword: 'Подтвердите новый пароль',
      passwordChanged: 'Пароль успешно изменён',
      passwordsDontMatch: 'Пароли не совпадают',
      uploadAvatar: 'Загрузить аватар',
      removeAvatar: 'Удалить аватар',
      avatarUploaded: 'Аватар загружен',
      avatarRemoved: 'Аватар удалён',
      deleteAccountDesc: 'Введите пароль для подтверждения удаления аккаунта',
      accountDeleted: 'Аккаунт удалён',
      enterPassword: 'Введите пароль'
    },
    auth: {
      login: 'Войти',
      register: 'Регистрация',
      email: 'Email',
      password: 'Пароль',
      confirmPassword: 'Подтвердите пароль',
      name: 'Имя',
      dontHaveAccount: 'Нет аккаунта?',
      alreadyHaveAccount: 'Уже есть аккаунт?',
      forgotPassword: 'Забыли пароль?',
      noAccountCanRegister: 'Если у тебя нет аккаунта можешь',
      registerLink: 'зарегистрироваться',
      alreadyHaveAccountLink: 'Войти',
      enterEmail: 'Введите свою почту',
      enterPassword: 'Введите свой пароль',
      enterName: 'Введите ваше имя',
      confirmYourPassword: 'Подтвердите пароль',
      loggingIn: 'Вход...',
      registering: 'Регистрация...',
      registerButton: 'Зарегистрироваться',
      socialText: 'Также можно пройти быструю регистрацию/вход на этих сервисах',
      soon: 'Скоро',
      passwordsMatch: 'Пароли совпадают',
      passwordsDontMatch: 'Пароли не совпадают',
      passwordTooShort: 'Пароль должен содержать минимум 8 символов',
      passwordNeedsDigit: 'Пароль должен содержать хотя бы одну цифру',
      passwordNeedsSpecial: 'Пароль должен содержать хотя бы один специальный символ (!@#$%^&* и т.д.)',
      hintMinLength: 'Минимум 8 символов',
      hintDigit: 'Хотя бы одна цифра (0-9)',
      hintSpecial: 'Хотя бы один спецсимвол (!@#$%^&*)',
      invalidEmail: 'Введите корректный email адрес',
      verifyTitle: 'Подтвердите email',
      verifySubtitle: 'Мы отправили 6-значный код на',
      verifyCodePlaceholder: 'Введите 6-значный код',
      verifyButton: 'Подтвердить',
      verifying: 'Проверка...',
      resendCode: 'Отправить код повторно',
      codeSent: 'Код отправлен!',
      codeResent: 'Новый код отправлен',
      checkServerConsole: 'Код доступен в консоли сервера',
      emailNotVerified: 'Ваш email ещё не подтверждён',
      goToVerification: 'Подтвердить',
      oauthError: 'Вход через сервис не удался. Попробуйте ещё раз',
      forgotPasswordTitle: 'Сброс пароля',
      forgotPasswordSubtitle: 'Введите email и мы отправим вам код для сброса',
      sendResetCode: 'Отправить код',
      sending: 'Отправка...',
      backToLogin: 'Вернуться к входу',
      enterResetCode: 'Введите код',
      resetCodeSentTo: 'Мы отправили 6-значный код на',
      confirmCode: 'Подтвердить',
      newPasswordTitle: 'Новый пароль',
      newPasswordSubtitle: 'Придумайте новый пароль для вашего аккаунта',
      enterNewPassword: 'Введите новый пароль',
      resetPassword: 'Сбросить пароль',
      resetting: 'Сброс...',
      passwordResetSuccess: 'Пароль сброшен!',
      passwordResetSuccessSubtitle: 'Ваш пароль успешно изменён. Теперь вы можете войти с новым паролем.'
    },
    common: {
      loading: 'Загрузка...',
      error: 'Ошибка',
      success: 'Успешно',
      save: 'Сохранить',
      cancel: 'Отмена',
      delete: 'Удалить',
      edit: 'Изменить',
      close: 'Закрыть',
      search: 'Поиск',
      filter: 'Фильтр',
      settings: 'Настройки'
    },
    logs: {
      device_on: 'Устройство включено: {name}',
      device_off: 'Устройство выключено: {name}',
      device_add: 'Устройство добавлено: {name}',
      device_update: 'Устройство обновлено: {name}',
      device_delete: 'Устройство удалено: {name}',
      user_login: 'Вход в систему',
      password_change: 'Пароль изменён',
      profile_update: 'Профиль обновлён',
      field_name: 'название',
      field_room: 'комната',
      field_type: 'тип',
      field_property: 'свойство',
      changed_from_to: 'изменено с "{from}" на "{to}"',
      just_now: 'только что',
      minutes_ago: '{n} мин назад',
      hours_ago: '{n} ч назад',
      days_ago: '{n} дн назад'
    }
  }
}

export const useI18nStore = defineStore('i18n', () => {
  // Получаем язык из localStorage или используем браузерный
  const getInitialLocale = () => {
    const saved = localStorage.getItem('locale')
    if (saved && translations[saved]) {
      return saved
    }

    // Пробуем получить язык браузера
    const browserLang = navigator.language.split('-')[0]
    if (translations[browserLang]) {
      return browserLang
    }

    // По умолчанию русский
    return 'ru'
  }

  const locale = ref(getInitialLocale())

  // Доступные языки
  const availableLocales = computed(() => Object.keys(translations))

  // Текущий перевод
  const currentTranslations = computed(() => translations[locale.value])

  // Установка языка
  const setLocale = (newLocale) => {
    if (translations[newLocale]) {
      locale.value = newLocale
      localStorage.setItem('locale', newLocale)

      // Устанавливаем атрибут языка для HTML
      document.documentElement.setAttribute('lang', newLocale)
    }
  }

  // Функция перевода (вспомогательная)
  const t = (key) => {
    const keys = key.split('.')
    let value = currentTranslations.value

    for (const k of keys) {
      if (value && typeof value === 'object' && k in value) {
        value = value[k]
      } else {
        console.warn(`Translation key not found: ${key}`)
        return key
      }
    }

    return value
  }

  // Инициализация при загрузке
  const init = () => {
    document.documentElement.setAttribute('lang', locale.value)
  }

  return {
    locale,
    availableLocales,
    currentTranslations,
    setLocale,
    t,
    init
  }
})
